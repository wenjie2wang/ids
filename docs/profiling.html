
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.12. Profiling &#8212; Introduction to Data Science</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.13. Gamma MLE Simulation Study" href="mle-gamma.html" />
    <link rel="prev" title="3.11. Python dictionary" href="dict_in_python.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/tricircle.pdf" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Introduction to Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="tasks.html">
   1. Task Board
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   2. Introduction
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="pybasics.html">
   3. Python for R Users
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="dict_in_python.html">
     3.11. Python dictionary
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.12. Profiling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mle-gamma.html">
     3.13. Gamma MLE Simulation Study
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Numpy.html">
   4. Numpy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="NumpyAdvanced.html">
     4.2. Numpy Advanced
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Scipy.html">
   5. Scipy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Optimization.html">
     5.3. Optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pandas_objs.html">
   6. Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Pandas_missing_hierarchical.html">
     6.12. Pandas: Missing Data and Hierarchical Indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Pandas_Dataset_Operations.html">
     6.13. Pandas: Dataset Operations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="sklearn.html">
   7. Scikit Learn
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="Measures_of_classification_accuracy.html">
     7.1. Measures of classification accuracy and functions in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Fraud_Detection_Python_from_GitHub.html">
     7.2. Fraud Detection with Python (Github Trenton McKinney)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Support_vector_machine.html">
     7.3. Support vector machine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Decision_Trees_and_Random_Forest.html">
     7.5. Decision Trees and Random Forest
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="naive_bayes.html">
     7.6. Naive Bayes Classification Problem:
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dscompetition.html">
   8. Data Science Competition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="misc.html">
   9. Miscellaneous learnings
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/docs/profiling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/profiling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/jun-yan/ids/master?urlpath=tree/notes/docs/profiling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivation-for-profiling">
   3.12.1. Motivation for Profiling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resources-mostly-profiled">
   3.12.2. Resources mostly profiled
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling-cpu-time">
   3.12.3. Profiling CPU time
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#timeit-function-usage">
     3.12.3.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       timeit
      </span>
     </code>
     function usage:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#command-line-interface-for-timeit">
       3.12.3.1.1. Command Line Interface for
       <code class="docutils literal notranslate">
        <span class="pre">
         timeit
        </span>
       </code>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cprofile-function-usage">
     3.12.3.2.
     <code class="docutils literal notranslate">
      <span class="pre">
       cProfile
      </span>
     </code>
     function usage
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-output-for-cprofile-run">
       3.12.3.2.1. Save output for
       <code class="docutils literal notranslate">
        <span class="pre">
         cProfile.run()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#command-line-for-cprofile">
       3.12.3.2.2. Command Line for cProfile
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pstats-stats-for-output-log-of-cprofile">
       3.12.3.2.3.
       <code class="docutils literal notranslate">
        <span class="pre">
         pstats.Stats
        </span>
       </code>
       for output log of
       <code class="docutils literal notranslate">
        <span class="pre">
         cProfile()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#deterministic-profiling-of-cprofile">
       3.12.3.2.4. Deterministic Profiling of cProfile
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interpretation-of-cprofile">
       3.12.3.2.5. Interpretation of cProfile
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#line-profiler">
     3.12.3.3. Line Profiler
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#profiling-memory">
   3.12.4. Profiling Memory
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#memory-profiler">
     3.12.4.1. Memory_Profiler
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <!-- (about_py)= -->
<div class="tex2jax_ignore mathjax_ignore section" id="profiling">
<h1><span class="section-number">3.12. </span>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="motivation-for-profiling">
<h2><span class="section-number">3.12.1. </span>Motivation for Profiling<a class="headerlink" href="#motivation-for-profiling" title="Permalink to this headline">¶</a></h2>
<p>Time optimization is one most common reason for timing and
profiling. The understanding is that only some small chunk often makes
our code heavy in terms of time taken, memory usage, etc. Finding it
and improving or managing it can improve our resource usage.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">Slow</span></code></p></th>
<th class="text-align:center head"><p><code class="docutils literal notranslate"><span class="pre">Fast</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p><img src="https://www.seekpng.com/png/detail/127-1274961_visit-zootopia-jpg-free-sloth-characters-in-zootopia.png" width="425"/></p></td>
<td class="text-align:center"><p><img src="https://freepngimg.com/thumb/the_flash/5-2-flash-free-png-image.png" width="425"/></p></td>
</tr>
</tbody>
</table>
<p>It is especially important to profile code chunks to optimize them. This becomes
more important in a production environment where resources are expensive and
cannot be wasted. Therefore, as part of testing, one should include profiling to
see which chunks use most resources and which chunks use less. Some coding
contests often have a maximum time to run and these situations also
lead to its necessity.</p>
</div>
<div class="section" id="resources-mostly-profiled">
<h2><span class="section-number">3.12.2. </span>Resources mostly profiled<a class="headerlink" href="#resources-mostly-profiled" title="Permalink to this headline">¶</a></h2>
<p>The most common resources that we often optimize for projects are:</p>
<ul class="simple">
<li><p>CPU time</p></li>
<li><p>Memory Usage</p></li>
</ul>
<p>But some other resources could also be network bandwidth usage etc. For example,
if you wish to create a notebook that gathers stock data from one of many
locations such as Yahoo Finance etc, and you only have a limited bandwidth, your
choice could also depend on where you gather your data from.</p>
</div>
<div class="section" id="profiling-cpu-time">
<h2><span class="section-number">3.12.3. </span>Profiling CPU time<a class="headerlink" href="#profiling-cpu-time" title="Permalink to this headline">¶</a></h2>
<p>Profiling implies that it divides the entire code file into smaller code chunks
(<em>functions/lines</em>) in order to show the resource usage and thus existence of
bottlenecks in our code. It is best practice to find bottlenecks by means of
profiling rather than by intuition.</p>
<p>Python includes the following modules that achieve profiling for CPU time:</p>
<ul class="simple">
<li><p>timeit</p></li>
<li><p>cprofile</p></li>
<li><p>profile</p></li>
<li><p>lineprofile</p></li>
</ul>
<p>For interpretation, we use the fibonacci example shown in class:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The profiler modules are designed to provide an execution profile for a
given program, not for benchmarking purposes (for that, there is timeit for
reasonably accurate results). This particularly applies to benchmarking Python
code against C code: the profilers introduce overhead for Python code, but not
for C-level functions, and so the C code would seem faster than any Python
one.</p>
</div>
<div class="section" id="timeit-function-usage">
<h3><span class="section-number">3.12.3.1. </span><code class="docutils literal notranslate"><span class="pre">timeit</span></code> function usage:<a class="headerlink" href="#timeit-function-usage" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>    <span class="c1">## !pip3 install pandas (uncomment to add)</span>
<span class="kn">import</span> <span class="nn">timeit</span>    <span class="c1">## base package</span>

<span class="c1">### First interpretation using dynamic programming memorization</span>
<span class="k">def</span> <span class="nf">fib_dm_helper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">mem</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mem</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mem</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">n</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fib_dm_helper</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mem</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib_dm_helper</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mem</span><span class="p">)</span>
    <span class="n">mem</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">fib_dm</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">mem</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fib_dm_helper</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">mem</span><span class="p">)</span>

<span class="o">%</span><span class="n">timeit</span> <span class="n">fib_dm</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### Using dynamic programming bottom up for timeit</span>
<span class="k">def</span> <span class="nf">fib_dbu</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">mem</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">mem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mem</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mem</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
	

<span class="o">%</span><span class="n">timeit</span> <span class="n">fib_dbu</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1">## timeit application of fib_dbu</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="command-line-interface-for-timeit">
<h4><span class="section-number">3.12.3.1.1. </span>Command Line Interface for <code class="docutils literal notranslate"><span class="pre">timeit</span></code><a class="headerlink" href="#command-line-interface-for-timeit" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!python -m timeit -r 20 &#39;&quot;-&quot;.join(str(n) for n in range(100))&#39;  ## r does repetition
## The output suggests there were 20000 loops, repeated 20 times for accuracy, and 
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="cprofile-function-usage">
<h3><span class="section-number">3.12.3.2. </span><code class="docutils literal notranslate"><span class="pre">cProfile</span></code>  function usage<a class="headerlink" href="#cprofile-function-usage" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">cProfile</span></code> allows to profile functions’ CPU time. A lot more info on how this can be used can also be obtained at Source: <a class="reference external" href="https://docs.python.org/3/library/profile.html">[The python Profilers]</a>.</p>
<p>For profiling a function with one argument, you can do the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cProfile</span>   <span class="c1">## for profiling function</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;fib_dm(2000)&#39;</span><span class="p">)</span>
<span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;fib_dbu(2000)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Interpretation of the above <code class="docutils literal notranslate"><span class="pre">cProfile.run()</span></code></strong>:</p>
<ul class="simple">
<li><p>The first line indicates that 4001 calls were monitored of which 5 were
primitive calls (calls that are not induced via recursion).</p></li>
<li><p>“Ordered by: standard name” suggests usage of the last column for sorting the
output.</p></li>
<li><p>When there are two numbers in the first column (for example 3997/1), it means
that the function recursed 3997 times while it was called once.</p></li>
<li><p>(x/y) for the first column says that y is the primitive calls and x is the
recursive calls.</p></li>
</ul>
<p>The column headings are interpreted as:</p>
<ul class="simple">
<li><p>ncalls: for the number of calls.</p></li>
<li><p>tottime: for the total time spent in the given function (and excluding time
made in calls to sub-functions)</p></li>
<li><p>percall: is the quotient of tottime divided by ncalls</p></li>
<li><p>cumtime: is the cumulative time spent in this and all subfunctions (from
invocation till exit). This figure is accurate even for recursive functions.</p></li>
<li><p>percall: is the quotient of cumtime divided by primitive calls</p></li>
<li><p>filename: lineno(function) provides the respective data of each function</p></li>
</ul>
<div class="section" id="save-output-for-cprofile-run">
<h4><span class="section-number">3.12.3.2.1. </span>Save output for <code class="docutils literal notranslate"><span class="pre">cProfile.run()</span></code><a class="headerlink" href="#save-output-for-cprofile-run" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also save the run output to a file by providing it as the second
argument as follows:</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;fib_dm(2000)&#39;</span><span class="p">,</span> <span class="s1">&#39;restats.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="command-line-for-cprofile">
<h4><span class="section-number">3.12.3.2.2. </span>Command Line for cProfile<a class="headerlink" href="#command-line-for-cprofile" title="Permalink to this headline">¶</a></h4>
<p>The files cProfile and profile can also be invoked using command line to profile
another python script containing multiple functions. But keep in mind, that
profiling an entire script will include overhead time for importing, creating a function.</p>
<p>For Example, the code commented below can also create <code class="docutils literal notranslate"><span class="pre">restats.log</span></code> by profiling
<code class="docutils literal notranslate"><span class="pre">myscript.py</span></code> if there exists such a python script file in the directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## run using bash and saved `py` file</span>
<span class="c1">## !python -m cProfile -o restats.log myscript.py # myscript.py does not exist</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pstats-stats-for-output-log-of-cprofile">
<h4><span class="section-number">3.12.3.2.3. </span><code class="docutils literal notranslate"><span class="pre">pstats.Stats</span></code> for output log of <code class="docutils literal notranslate"><span class="pre">cProfile()</span></code><a class="headerlink" href="#pstats-stats-for-output-log-of-cprofile" title="Permalink to this headline">¶</a></h4>
<p>The pstats.Stats class reads profile results from a file and formats them in
readable manner.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install pstats   # pip install from within notebook using bash magic command</span>
<span class="kn">import</span> <span class="nn">pstats</span>  <span class="c1">## Clean reprsentation of profile</span>
<span class="kn">from</span> <span class="nn">pstats</span> <span class="kn">import</span> <span class="n">SortKey</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="s1">&#39;restats.log&#39;</span><span class="p">)</span> <span class="c1">## uses the above file created with output</span>
<span class="n">p</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### some possible print outputs</span>
<span class="n">p</span><span class="o">.</span><span class="n">strip_dirs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">SortKey</span><span class="o">.</span><span class="n">CUMULATIVE</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">## sort cumulative time spent</span>
<span class="n">p</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">SortKey</span><span class="o">.</span><span class="n">TIME</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1">## sort time spent within each function</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="deterministic-profiling-of-cprofile">
<h4><span class="section-number">3.12.3.2.4. </span>Deterministic Profiling of cProfile<a class="headerlink" href="#deterministic-profiling-of-cprofile" title="Permalink to this headline">¶</a></h4>
<p>Deterministic profiling is meant to reflect the fact that all function call,
function return, and exception events are monitored, and precise timings are
made for the intervals between these events (during which time the user’s code
is executing). In contrast, statistical profiling (which is not done by cprofile
module) randomly samples the effective instruction pointer, and deduces where
time is being spent. The latter technique traditionally involves less overhead
(as the code does not need to be instrumented), but provides only relative
indications of where time is being spent.</p>
</div>
<div class="section" id="interpretation-of-cprofile">
<h4><span class="section-number">3.12.3.2.5. </span>Interpretation of cProfile<a class="headerlink" href="#interpretation-of-cprofile" title="Permalink to this headline">¶</a></h4>
<p>Call count statistics can be used to identify bugs in code (surprising counts),
and to identify possible inline-expansion points (high call counts). Internal
time statistics can be used to identify “hot loops” that should be carefully
optimized. Cumulative time statistics should be used to identify high level
errors in the selection of algorithms. Note that the unusual handling of
cumulative times in this profiler allows statistics for recursive
implementations of algorithms to be directly compared to iterative
implementations.</p>
</div>
</div>
<div class="section" id="line-profiler">
<h3><span class="section-number">3.12.3.3. </span>Line Profiler<a class="headerlink" href="#line-profiler" title="Permalink to this headline">¶</a></h3>
<p><em>line_profiler will profile the time individual lines of code take to
execute. The profiler is implemented in C via Cython in order to reduce the
overhead of profiling.</em> Also the timer unit is <span class="math notranslate nohighlight">\(10^{-6}\)</span> or <span class="math notranslate nohighlight">\(\mu s\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip3 install line_profiler  ## install line_profiler ## check if it is installed first</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">line_profiler</span> <span class="kn">import</span> <span class="n">LineProfiler</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">43</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>    <span class="c1">## Notice different for loop</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">))]</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LineProfiler</span><span class="p">()</span>
<span class="n">lp_wrapper</span> <span class="o">=</span> <span class="n">lp</span><span class="p">(</span><span class="n">do_stuff</span><span class="p">)</span>
<span class="n">lp_wrapper</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="n">lp</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## plot stats profiling by percentage
## NEED to install gprof2dot (brew on mac)
!gprof2dot -f pstats restats.log | dot -Tsvg -o mine.svg
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span>
<span class="n">SVG</span><span class="p">(</span><span class="s1">&#39;mine.svg&#39;</span><span class="p">)</span>

<span class="c1"># # !pip install ipyplot</span>
<span class="c1"># import ipyplot</span>

<span class="c1"># ipyplot.plot_images( [&#39;mine.svg&#39;], # images should be passed in as an array</span>
<span class="c1">#     img_width=250,</span>
<span class="c1">#     force_b64=True # this is important to be able to render the image correctly on GitHub</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## remove files
!rm mine.svg
!rm restats.log
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="profiling-memory">
<h2><span class="section-number">3.12.4. </span>Profiling Memory<a class="headerlink" href="#profiling-memory" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>memory_profiler (open source python package)</p></li>
<li><p>guppy</p></li>
</ul>
<div class="section" id="memory-profiler">
<h3><span class="section-number">3.12.4.1. </span>Memory_Profiler<a class="headerlink" href="#memory-profiler" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip3 install -U memory_profiler    ## install memory_profiler</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">memory_profiler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">memscript</span><span class="o">.</span><span class="n">py</span>
<span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">my_func</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">memscript</span> <span class="kn">import</span> <span class="n">my_func</span>
<span class="o">%</span><span class="n">mprun</span> <span class="o">-</span><span class="n">T</span> <span class="n">mprof0</span> <span class="o">-</span><span class="n">f</span> <span class="n">my_func</span> <span class="n">my_func</span><span class="p">()</span>

<span class="c1">## This goes into the pdb debugger as soon as 100MB is used</span>
<span class="c1">## !python3.9 -m memory_profiler --pdb-mmem=100 memscript.py  </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;mprof0&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## This can be improvised by mprof</span>
<span class="c1"># !pip3 install matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!mprof run memscript.py
!mprof plot -o image.svg

SVG(&#39;image.svg&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## Remove if not required to show.
!rm mprof0
!rm memscript.py
!rm image.svg
!rm mprofile_*
</pre></div>
</div>
</div>
</div>
<p>More information about this and even plots etc can be found at
<a class="reference external" href="https://pypi.org/project/memory-profiler/">Memory_Profiler</a>.</p>
<p>In case you are running mprof as a command line, then using the &#64;profile decorator
around a function or method and running python -m memory_profiler myscript will
result in required work. You’ll see line-by-line memory usage once your script exits.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="dict_in_python.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">3.11. </span>Python dictionary</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="mle-gamma.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">3.13. </span>Gamma MLE Simulation Study</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Jun Yan and students in STAT 5255, Fall 2021<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>